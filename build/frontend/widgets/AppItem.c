/* AppItem.c generated by valac 0.32.1, the Vala compiler
 * generated from AppItem.vala, do not modify */


#include <glib.h>
#include <glib-object.h>
#include <gtk/gtk.h>
#include <gdk-pixbuf/gdk-pixbuf.h>
#include <float.h>
#include <math.h>
#include <stdlib.h>
#include <string.h>
#include <gdk/gdk.h>
#include <cairo.h>


#define SLINGSHOT_FRONTEND_TYPE_APP_ITEM (slingshot_frontend_app_item_get_type ())
#define SLINGSHOT_FRONTEND_APP_ITEM(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), SLINGSHOT_FRONTEND_TYPE_APP_ITEM, SlingshotFrontendAppItem))
#define SLINGSHOT_FRONTEND_APP_ITEM_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), SLINGSHOT_FRONTEND_TYPE_APP_ITEM, SlingshotFrontendAppItemClass))
#define SLINGSHOT_FRONTEND_IS_APP_ITEM(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), SLINGSHOT_FRONTEND_TYPE_APP_ITEM))
#define SLINGSHOT_FRONTEND_IS_APP_ITEM_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), SLINGSHOT_FRONTEND_TYPE_APP_ITEM))
#define SLINGSHOT_FRONTEND_APP_ITEM_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), SLINGSHOT_FRONTEND_TYPE_APP_ITEM, SlingshotFrontendAppItemClass))

typedef struct _SlingshotFrontendAppItem SlingshotFrontendAppItem;
typedef struct _SlingshotFrontendAppItemClass SlingshotFrontendAppItemClass;
typedef struct _SlingshotFrontendAppItemPrivate SlingshotFrontendAppItemPrivate;

#define SLINGSHOT_FRONTEND_TYPE_COLOR (slingshot_frontend_color_get_type ())
typedef struct _SlingshotFrontendColor SlingshotFrontendColor;
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))
#define _g_free0(var) (var = (g_free (var), NULL))
#define _cairo_destroy0(var) ((var == NULL) ? NULL : (var = (cairo_destroy (var), NULL)))

struct _SlingshotFrontendAppItem {
	GtkEventBox parent_instance;
	SlingshotFrontendAppItemPrivate * priv;
};

struct _SlingshotFrontendAppItemClass {
	GtkEventBoxClass parent_class;
};

struct _SlingshotFrontendColor {
	gdouble R;
	gdouble G;
	gdouble B;
	gdouble A;
};

struct _SlingshotFrontendAppItemPrivate {
	GdkPixbuf* icon;
	SlingshotFrontendColor prominent;
	gchar* label;
	GtkVBox* wrapper;
	gint icon_size;
	gint current_frame;
};


static gpointer slingshot_frontend_app_item_parent_class = NULL;

GType slingshot_frontend_app_item_get_type (void) G_GNUC_CONST;
GType slingshot_frontend_color_get_type (void) G_GNUC_CONST;
SlingshotFrontendColor* slingshot_frontend_color_dup (const SlingshotFrontendColor* self);
void slingshot_frontend_color_free (SlingshotFrontendColor* self);
#define SLINGSHOT_FRONTEND_APP_ITEM_GET_PRIVATE(o) (G_TYPE_INSTANCE_GET_PRIVATE ((o), SLINGSHOT_FRONTEND_TYPE_APP_ITEM, SlingshotFrontendAppItemPrivate))
enum  {
	SLINGSHOT_FRONTEND_APP_ITEM_DUMMY_PROPERTY
};
#define SLINGSHOT_FRONTEND_APP_ITEM_FPS 24
#define SLINGSHOT_FRONTEND_APP_ITEM_DURATION 200
#define SLINGSHOT_FRONTEND_APP_ITEM_RUN_LENGTH ((gint) (SLINGSHOT_FRONTEND_APP_ITEM_DURATION / SLINGSHOT_FRONTEND_APP_ITEM_FPS))
SlingshotFrontendAppItem* slingshot_frontend_app_item_new (gint size);
SlingshotFrontendAppItem* slingshot_frontend_app_item_construct (GType object_type, gint size);
static gboolean slingshot_frontend_app_item_draw_icon (SlingshotFrontendAppItem* self, GtkWidget* widget, GdkEventExpose* event);
static gboolean _slingshot_frontend_app_item_draw_icon_gtk_widget_expose_event (GtkWidget* _sender, GdkEventExpose* event, gpointer self);
static gboolean slingshot_frontend_app_item_draw_background (SlingshotFrontendAppItem* self, GtkWidget* widget, GdkEventExpose* event);
static gboolean _slingshot_frontend_app_item_draw_background_gtk_widget_expose_event (GtkWidget* _sender, GdkEventExpose* event, gpointer self);
static gboolean __lambda5_ (SlingshotFrontendAppItem* self);
void slingshot_frontend_app_item_focus_in (SlingshotFrontendAppItem* self);
static gboolean ___lambda5__gtk_widget_focus_in_event (GtkWidget* _sender, GdkEventFocus* event, gpointer self);
static gboolean __lambda7_ (SlingshotFrontendAppItem* self);
void slingshot_frontend_app_item_focus_out (SlingshotFrontendAppItem* self);
static gboolean ___lambda7__gtk_widget_focus_out_event (GtkWidget* _sender, GdkEventFocus* event, gpointer self);
void slingshot_frontend_app_item_change_app (SlingshotFrontendAppItem* self, GdkPixbuf* new_icon, const gchar* new_name, const gchar* new_tooltip);
void slingshot_frontend_utilities_average_color (GdkPixbuf* source, SlingshotFrontendColor* result);
static gboolean __lambda6_ (SlingshotFrontendAppItem* self);
static gboolean ___lambda6__gsource_func (gpointer self);
static gboolean __lambda8_ (SlingshotFrontendAppItem* self);
static gboolean ___lambda8__gsource_func (gpointer self);
void slingshot_frontend_utilities_truncate_text (cairo_t* context, GtkAllocation* size, guint padding, const gchar* input, gchar** truncated, cairo_text_extents_t* truncated_extents);
static void slingshot_frontend_app_item_finalize (GObject* obj);


static gboolean _slingshot_frontend_app_item_draw_icon_gtk_widget_expose_event (GtkWidget* _sender, GdkEventExpose* event, gpointer self) {
	gboolean result;
	result = slingshot_frontend_app_item_draw_icon ((SlingshotFrontendAppItem*) self, _sender, event);
	return result;
}


static gboolean _slingshot_frontend_app_item_draw_background_gtk_widget_expose_event (GtkWidget* _sender, GdkEventExpose* event, gpointer self) {
	gboolean result;
	result = slingshot_frontend_app_item_draw_background ((SlingshotFrontendAppItem*) self, _sender, event);
	return result;
}


static gboolean __lambda5_ (SlingshotFrontendAppItem* self) {
	gboolean result = FALSE;
	slingshot_frontend_app_item_focus_in (self);
	result = TRUE;
	return result;
}


static gboolean ___lambda5__gtk_widget_focus_in_event (GtkWidget* _sender, GdkEventFocus* event, gpointer self) {
	gboolean result;
	result = __lambda5_ ((SlingshotFrontendAppItem*) self);
	return result;
}


static gboolean __lambda7_ (SlingshotFrontendAppItem* self) {
	gboolean result = FALSE;
	slingshot_frontend_app_item_focus_out (self);
	result = TRUE;
	return result;
}


static gboolean ___lambda7__gtk_widget_focus_out_event (GtkWidget* _sender, GdkEventFocus* event, gpointer self) {
	gboolean result;
	result = __lambda7_ ((SlingshotFrontendAppItem*) self);
	return result;
}


SlingshotFrontendAppItem* slingshot_frontend_app_item_construct (GType object_type, gint size) {
	SlingshotFrontendAppItem * self = NULL;
	gint _tmp0_ = 0;
	gint _tmp1_ = 0;
	gint _tmp2_ = 0;
	GtkVBox* _tmp3_ = NULL;
	GtkVBox* _tmp4_ = NULL;
	GtkVBox* _tmp5_ = NULL;
	self = (SlingshotFrontendAppItem*) g_object_new (object_type, NULL);
	_tmp0_ = size;
	self->priv->icon_size = _tmp0_;
	gtk_event_box_set_visible_window ((GtkEventBox*) self, FALSE);
	g_object_set ((GtkWidget*) self, "can-focus", TRUE, NULL);
	_tmp1_ = self->priv->icon_size;
	_tmp2_ = self->priv->icon_size;
	gtk_widget_set_size_request ((GtkWidget*) self, _tmp1_ * 2, _tmp2_ + 30);
	_tmp3_ = (GtkVBox*) gtk_vbox_new (FALSE, 0);
	g_object_ref_sink (_tmp3_);
	_g_object_unref0 (self->priv->wrapper);
	self->priv->wrapper = _tmp3_;
	_tmp4_ = self->priv->wrapper;
	g_signal_connect_object ((GtkWidget*) _tmp4_, "expose-event", (GCallback) _slingshot_frontend_app_item_draw_icon_gtk_widget_expose_event, self, 0);
	_tmp5_ = self->priv->wrapper;
	gtk_container_add ((GtkContainer*) self, (GtkWidget*) _tmp5_);
	g_signal_connect_object ((GtkWidget*) self, "expose-event", (GCallback) _slingshot_frontend_app_item_draw_background_gtk_widget_expose_event, self, 0);
	g_signal_connect_object ((GtkWidget*) self, "focus-in-event", (GCallback) ___lambda5__gtk_widget_focus_in_event, self, 0);
	g_signal_connect_object ((GtkWidget*) self, "focus-out-event", (GCallback) ___lambda7__gtk_widget_focus_out_event, self, 0);
	return self;
}


SlingshotFrontendAppItem* slingshot_frontend_app_item_new (gint size) {
	return slingshot_frontend_app_item_construct (SLINGSHOT_FRONTEND_TYPE_APP_ITEM, size);
}


static gpointer _g_object_ref0 (gpointer self) {
	return self ? g_object_ref (self) : NULL;
}


void slingshot_frontend_app_item_change_app (SlingshotFrontendAppItem* self, GdkPixbuf* new_icon, const gchar* new_name, const gchar* new_tooltip) {
	GdkPixbuf* _tmp0_ = NULL;
	GdkPixbuf* _tmp1_ = NULL;
	GdkPixbuf* _tmp2_ = NULL;
	SlingshotFrontendColor _tmp3_ = {0};
	const gchar* _tmp4_ = NULL;
	gchar* _tmp5_ = NULL;
	const gchar* _tmp6_ = NULL;
	GtkVBox* _tmp7_ = NULL;
	g_return_if_fail (self != NULL);
	g_return_if_fail (new_icon != NULL);
	g_return_if_fail (new_name != NULL);
	g_return_if_fail (new_tooltip != NULL);
	self->priv->current_frame = 1;
	_tmp0_ = new_icon;
	_tmp1_ = _g_object_ref0 (_tmp0_);
	_g_object_unref0 (self->priv->icon);
	self->priv->icon = _tmp1_;
	_tmp2_ = self->priv->icon;
	slingshot_frontend_utilities_average_color (_tmp2_, &_tmp3_);
	self->priv->prominent = _tmp3_;
	_tmp4_ = new_name;
	_tmp5_ = g_strdup (_tmp4_);
	_g_free0 (self->priv->label);
	self->priv->label = _tmp5_;
	_tmp6_ = new_tooltip;
	gtk_widget_set_tooltip_text ((GtkWidget*) self, _tmp6_);
	_tmp7_ = self->priv->wrapper;
	gtk_widget_queue_draw ((GtkWidget*) _tmp7_);
}


static gboolean __lambda6_ (SlingshotFrontendAppItem* self) {
	gboolean result = FALSE;
	gboolean _tmp0_ = FALSE;
	gint _tmp1_ = 0;
	gint _tmp4_ = 0;
	_tmp1_ = self->priv->current_frame;
	if (_tmp1_ >= SLINGSHOT_FRONTEND_APP_ITEM_RUN_LENGTH) {
		_tmp0_ = TRUE;
	} else {
		gboolean _tmp2_ = FALSE;
		gboolean _tmp3_ = FALSE;
		g_object_get ((GtkWidget*) self, "has-focus", &_tmp2_, NULL);
		_tmp3_ = _tmp2_;
		_tmp0_ = !_tmp3_;
	}
	if (_tmp0_) {
		self->priv->current_frame = 1;
		result = FALSE;
		return result;
	}
	gtk_widget_queue_draw ((GtkWidget*) self);
	_tmp4_ = self->priv->current_frame;
	self->priv->current_frame = _tmp4_ + 1;
	result = TRUE;
	return result;
}


static gboolean ___lambda6__gsource_func (gpointer self) {
	gboolean result;
	result = __lambda6_ ((SlingshotFrontendAppItem*) self);
	return result;
}


void slingshot_frontend_app_item_focus_in (SlingshotFrontendAppItem* self) {
	g_return_if_fail (self != NULL);
	g_timeout_add_full (G_PRIORITY_DEFAULT, (guint) ((gint) (1000 / SLINGSHOT_FRONTEND_APP_ITEM_FPS)), ___lambda6__gsource_func, g_object_ref (self), g_object_unref);
}


static gboolean __lambda8_ (SlingshotFrontendAppItem* self) {
	gboolean result = FALSE;
	gboolean _tmp0_ = FALSE;
	gint _tmp1_ = 0;
	gint _tmp4_ = 0;
	_tmp1_ = self->priv->current_frame;
	if (_tmp1_ >= SLINGSHOT_FRONTEND_APP_ITEM_RUN_LENGTH) {
		_tmp0_ = TRUE;
	} else {
		gboolean _tmp2_ = FALSE;
		gboolean _tmp3_ = FALSE;
		g_object_get ((GtkWidget*) self, "has-focus", &_tmp2_, NULL);
		_tmp3_ = _tmp2_;
		_tmp0_ = _tmp3_;
	}
	if (_tmp0_) {
		self->priv->current_frame = 1;
		result = FALSE;
		return result;
	}
	gtk_widget_queue_draw ((GtkWidget*) self);
	_tmp4_ = self->priv->current_frame;
	self->priv->current_frame = _tmp4_ + 1;
	result = TRUE;
	return result;
}


static gboolean ___lambda8__gsource_func (gpointer self) {
	gboolean result;
	result = __lambda8_ ((SlingshotFrontendAppItem*) self);
	return result;
}


void slingshot_frontend_app_item_focus_out (SlingshotFrontendAppItem* self) {
	g_return_if_fail (self != NULL);
	g_timeout_add_full (G_PRIORITY_DEFAULT, (guint) ((gint) (1000 / SLINGSHOT_FRONTEND_APP_ITEM_FPS)), ___lambda8__gsource_func, g_object_ref (self), g_object_unref);
}


static gboolean slingshot_frontend_app_item_draw_icon (SlingshotFrontendAppItem* self, GtkWidget* widget, GdkEventExpose* event) {
	gboolean result = FALSE;
	GtkAllocation size = {0};
	GtkWidget* _tmp0_ = NULL;
	GtkAllocation _tmp1_ = {0};
	cairo_t* context = NULL;
	GtkWidget* _tmp2_ = NULL;
	GdkWindow* _tmp3_ = NULL;
	cairo_t* _tmp4_ = NULL;
	GdkPixbuf* _tmp5_ = NULL;
	GtkAllocation _tmp6_ = {0};
	gint _tmp7_ = 0;
	GdkPixbuf* _tmp8_ = NULL;
	gint _tmp9_ = 0;
	gint _tmp10_ = 0;
	GtkAllocation _tmp11_ = {0};
	gint _tmp12_ = 0;
	GtkAllocation _tmp13_ = {0};
	gint _tmp14_ = 0;
	cairo_text_extents_t extents = {0};
	GtkAllocation _tmp15_ = {0};
	const gchar* _tmp16_ = NULL;
	gchar* _tmp17_ = NULL;
	cairo_text_extents_t _tmp18_ = {0};
	GtkAllocation _tmp19_ = {0};
	gint _tmp20_ = 0;
	GtkAllocation _tmp21_ = {0};
	gint _tmp22_ = 0;
	cairo_text_extents_t _tmp23_ = {0};
	gdouble _tmp24_ = 0.0;
	GtkAllocation _tmp25_ = {0};
	gint _tmp26_ = 0;
	GtkAllocation _tmp27_ = {0};
	gint _tmp28_ = 0;
	const gchar* _tmp29_ = NULL;
	GtkAllocation _tmp30_ = {0};
	gint _tmp31_ = 0;
	GtkAllocation _tmp32_ = {0};
	gint _tmp33_ = 0;
	cairo_text_extents_t _tmp34_ = {0};
	gdouble _tmp35_ = 0.0;
	GtkAllocation _tmp36_ = {0};
	gint _tmp37_ = 0;
	GtkAllocation _tmp38_ = {0};
	gint _tmp39_ = 0;
	const gchar* _tmp40_ = NULL;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (widget != NULL, FALSE);
	g_return_val_if_fail (event != NULL, FALSE);
	_tmp0_ = widget;
	gtk_widget_get_allocation (_tmp0_, &_tmp1_);
	size = _tmp1_;
	_tmp2_ = widget;
	_tmp3_ = _tmp2_->window;
	_tmp4_ = gdk_cairo_create ((GdkDrawable*) _tmp3_);
	context = _tmp4_;
	_tmp5_ = self->priv->icon;
	_tmp6_ = size;
	_tmp7_ = _tmp6_.x;
	_tmp8_ = self->priv->icon;
	_tmp9_ = gdk_pixbuf_get_width (_tmp8_);
	_tmp10_ = _tmp9_;
	_tmp11_ = size;
	_tmp12_ = _tmp11_.width;
	_tmp13_ = size;
	_tmp14_ = _tmp13_.y;
	gdk_cairo_set_source_pixbuf (context, _tmp5_, _tmp7_ + ((_tmp10_ - _tmp12_) / (-2.0)), (gdouble) _tmp14_);
	cairo_paint (context);
	cairo_select_font_face (context, "Sans", CAIRO_FONT_SLANT_NORMAL, CAIRO_FONT_WEIGHT_NORMAL);
	cairo_set_font_size (context, 11.5);
	_tmp15_ = size;
	_tmp16_ = self->priv->label;
	slingshot_frontend_utilities_truncate_text (context, &_tmp15_, (guint) 10, _tmp16_, &_tmp17_, &_tmp18_);
	_g_free0 (self->priv->label);
	self->priv->label = _tmp17_;
	extents = _tmp18_;
	_tmp19_ = size;
	_tmp20_ = _tmp19_.x;
	_tmp21_ = size;
	_tmp22_ = _tmp21_.width;
	_tmp23_ = extents;
	_tmp24_ = _tmp23_.width;
	_tmp25_ = size;
	_tmp26_ = _tmp25_.y;
	_tmp27_ = size;
	_tmp28_ = _tmp27_.height;
	cairo_move_to (context, ((_tmp20_ + (_tmp22_ / 2)) - (_tmp24_ / 2)) + 1, (gdouble) (((_tmp26_ + _tmp28_) - 10) + 1));
	cairo_set_source_rgba (context, 0.0, 0.0, 0.0, 0.8);
	_tmp29_ = self->priv->label;
	cairo_show_text (context, _tmp29_);
	cairo_set_source_rgba (context, 1.0, 1.0, 1.0, 1.0);
	_tmp30_ = size;
	_tmp31_ = _tmp30_.x;
	_tmp32_ = size;
	_tmp33_ = _tmp32_.width;
	_tmp34_ = extents;
	_tmp35_ = _tmp34_.width;
	_tmp36_ = size;
	_tmp37_ = _tmp36_.y;
	_tmp38_ = size;
	_tmp39_ = _tmp38_.height;
	cairo_move_to (context, (_tmp31_ + (_tmp33_ / 2)) - (_tmp35_ / 2), (gdouble) ((_tmp37_ + _tmp39_) - 10));
	_tmp40_ = self->priv->label;
	cairo_show_text (context, _tmp40_);
	result = FALSE;
	_cairo_destroy0 (context);
	return result;
}


static gboolean slingshot_frontend_app_item_draw_background (SlingshotFrontendAppItem* self, GtkWidget* widget, GdkEventExpose* event) {
	gboolean result = FALSE;
	GtkAllocation size = {0};
	GtkWidget* _tmp0_ = NULL;
	GtkAllocation _tmp1_ = {0};
	cairo_t* context = NULL;
	GtkWidget* _tmp2_ = NULL;
	GdkWindow* _tmp3_ = NULL;
	cairo_t* _tmp4_ = NULL;
	gdouble progress = 0.0;
	gint _tmp5_ = 0;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (widget != NULL, FALSE);
	g_return_val_if_fail (event != NULL, FALSE);
	_tmp0_ = widget;
	gtk_widget_get_allocation (_tmp0_, &_tmp1_);
	size = _tmp1_;
	_tmp2_ = widget;
	_tmp3_ = _tmp2_->window;
	_tmp4_ = gdk_cairo_create ((GdkDrawable*) _tmp3_);
	context = _tmp4_;
	_tmp5_ = self->priv->current_frame;
	if (_tmp5_ > 1) {
		gint _tmp6_ = 0;
		_tmp6_ = self->priv->current_frame;
		progress = ((gdouble) SLINGSHOT_FRONTEND_APP_ITEM_RUN_LENGTH) / ((gdouble) _tmp6_);
	} else {
		progress = (gdouble) 1;
	}
	result = FALSE;
	_cairo_destroy0 (context);
	return result;
}


static void slingshot_frontend_app_item_class_init (SlingshotFrontendAppItemClass * klass) {
	slingshot_frontend_app_item_parent_class = g_type_class_peek_parent (klass);
	g_type_class_add_private (klass, sizeof (SlingshotFrontendAppItemPrivate));
	G_OBJECT_CLASS (klass)->finalize = slingshot_frontend_app_item_finalize;
}


static void slingshot_frontend_app_item_instance_init (SlingshotFrontendAppItem * self) {
	self->priv = SLINGSHOT_FRONTEND_APP_ITEM_GET_PRIVATE (self);
	self->priv->current_frame = 1;
}


static void slingshot_frontend_app_item_finalize (GObject* obj) {
	SlingshotFrontendAppItem * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (obj, SLINGSHOT_FRONTEND_TYPE_APP_ITEM, SlingshotFrontendAppItem);
	_g_object_unref0 (self->priv->icon);
	_g_free0 (self->priv->label);
	_g_object_unref0 (self->priv->wrapper);
	G_OBJECT_CLASS (slingshot_frontend_app_item_parent_class)->finalize (obj);
}


GType slingshot_frontend_app_item_get_type (void) {
	static volatile gsize slingshot_frontend_app_item_type_id__volatile = 0;
	if (g_once_init_enter (&slingshot_frontend_app_item_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (SlingshotFrontendAppItemClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) slingshot_frontend_app_item_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (SlingshotFrontendAppItem), 0, (GInstanceInitFunc) slingshot_frontend_app_item_instance_init, NULL };
		GType slingshot_frontend_app_item_type_id;
		slingshot_frontend_app_item_type_id = g_type_register_static (GTK_TYPE_EVENT_BOX, "SlingshotFrontendAppItem", &g_define_type_info, 0);
		g_once_init_leave (&slingshot_frontend_app_item_type_id__volatile, slingshot_frontend_app_item_type_id);
	}
	return slingshot_frontend_app_item_type_id__volatile;
}



